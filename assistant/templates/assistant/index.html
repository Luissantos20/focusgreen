{% extends 'base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'assistant/css/assistant.css' %}">

<div class="assistant-bg">
  <div class="container py-5">
    <div class="assistant-header text-center mb-5">
      <img src="{% static 'assistant/img/robo_assistente.png' %}" 
           alt="Assistente FocusGreen" 
           class="assistant-bot mb-3">
      <h2>🧠 Assistente FocusGreen</h2>
      <p>Seu guia inteligente para um tempo digital mais equilibrado 🌎</p>
    </div>

    <div class="card-assistant text-center">
      <form method="post" id="ai-form">
        {% csrf_token %}
        <button type="submit" class="btn-green" id="generate-btn">
          🌿 Gerar Insight
        </button>
      </form>

      <div class="loader" id="loading-spinner"></div>

      <!-- Área dinâmica do insight -->
      <div id="insight-container" class="insight-box mt-4" style="display: none;">
        <h5>✨ Insight do Dia</h5>
        <p id="typed-insight"></p>
      </div>

      {% if ai_response %}
        <script>
          window.generatedInsight = `{{ ai_response|escapejs }}`;
        </script>
      {% endif %}
    </div>

    <div class="footer-note">
      🌱 Pequenas ações digitais, grandes impactos sustentáveis.
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('ai-form');
  const spinner = document.getElementById('loading-spinner');
  const button = document.getElementById('generate-btn');
  const insightBox = document.getElementById('insight-container');
  const insightText = document.getElementById('typed-insight');

  form.addEventListener('submit', () => {
    spinner.style.display = 'block';
    button.disabled = true;
    button.innerText = 'Gerando insight... 🌱';
  });

  // efeito de digitação
  document.addEventListener('DOMContentLoaded', () => {
    if (window.generatedInsight) {
      spinner.style.display = 'none';
      insightBox.style.display = 'block';
      const text = window.generatedInsight;
      let i = 0;
      function type() {
        if (i < text.length) {
          insightText.innerHTML += text.charAt(i);
          i++;
          setTimeout(type, 25);
        }
      }
      setTimeout(type, 400);
    }
  });
</script>

{% endblock %}
